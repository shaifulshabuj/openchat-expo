# Master Prompt 001: Phase 0.B - Project Scaffolding

**Date:** 2026-02-04 14:20 JST  
**Phase:** 0.B - Project Scaffolding (Week 1-2 of 20)  
**Type:** Phase  
**Estimated Duration:** 2 weeks (10 working days)  
**Codex Tasks:** 12 atomic tasks

---

## üéØ Objective

Complete the foundational setup of the OpenChat Expo project by initializing the mobile app (Expo), backend (NestJS), database (Prisma), type-safe API layer (tRPC), and local development environment (Docker Compose). This phase establishes the technical infrastructure required for all future feature development across iOS, Android, and Web platforms.

Upon completion, developers will be able to:
- Run the Expo mobile app on iOS/Android simulators and web browsers
- Start the NestJS backend with health checks passing
- Execute tRPC procedures from the mobile client
- Use Docker Compose for local PostgreSQL and Redis services
- Build and deploy via EAS Build and CI/CD pipeline

---

## üìã Context

### Current State:
- ‚úÖ GitHub repository created (`openchat-expo`)
- ‚úÖ Copilot agentic infrastructure complete (240KB documentation)
- ‚úÖ 10 skills documented with workflows
- ‚úÖ 7-phase orchestration protocol validated
- ‚úÖ Master prompts system created (this file)
- ‚úÖ Codex CLI task system ready
- ‚úÖ All decisions made (NativeBase, integrated approach, 20-week timeline)
- üìã No apps or packages exist yet

### Desired State:
- ‚úÖ Expo mobile app running (`apps/mobile/`)
- ‚úÖ NestJS backend running (`apps/api/`)
- ‚úÖ Shared packages created (`packages/types/`, `packages/config/`)
- ‚úÖ Prisma schema migrated (14 models from PWA)
- ‚úÖ tRPC client-server communication working
- ‚úÖ Docker Compose services operational (PostgreSQL, Redis)
- ‚úÖ EAS Build configured
- ‚úÖ CI/CD pipeline passing
- ‚úÖ All 12 Codex tasks complete
- ‚úÖ Phase 0.B marked complete

### Why This Master Prompt:
- **Foundation:** Everything else depends on this infrastructure
- **Blocking:** All 77 features require these base services
- **Critical Path:** Must complete before Phase 1 (Authentication) can start
- **Risk Reduction:** Catches integration issues early
- **Developer Experience:** Establishes smooth development workflow

---

## üß© Task Decomposition

This master prompt breaks down into 12 Codex tasks:

### Codex Task 1: Initialize Expo Mobile App
- **File:** `CODEX_001_20260204.prompts.md` (to be created)
- **What:** Create Expo app with tabs template, TypeScript, in `apps/mobile/`
- **Files:** ~50 files (new directory)
- **Time:** 30 minutes
- **Status:** NOT STARTED

### Codex Task 2: Install and Configure NativeBase
- **File:** `CODEX_002_20260204.prompts.md` (to be created)
- **What:** Add NativeBase UI library to mobile app
- **Files:** 2 files (package.json, _layout.tsx)
- **Time:** 30 minutes
- **Status:** NOT STARTED

### Codex Task 3: Configure NativeWind
- **File:** `CODEX_003_20260205.prompts.md` (to be created)
- **What:** Setup Tailwind CSS for React Native
- **Files:** 3 files (tailwind.config.js, babel.config.js, app.json)
- **Time:** 30 minutes
- **Status:** NOT STARTED

### Codex Task 4: Initialize NestJS Backend
- **File:** `CODEX_004_20260205.prompts.md` (to be created)
- **What:** Create NestJS API in `apps/api/`
- **Files:** ~40 files (new directory)
- **Time:** 30 minutes
- **Status:** NOT STARTED

### Codex Task 5: Migrate Prisma Schema
- **File:** `CODEX_005_20260206.prompts.md` (to be created)
- **What:** Copy 14 database models from PWA project
- **Files:** 1 file (schema.prisma)
- **Time:** 20 minutes
- **Status:** NOT STARTED

### Codex Task 6: Configure tRPC in NestJS
- **File:** `CODEX_006_20260206.prompts.md` (to be created)
- **What:** Setup tRPC server with health check procedure
- **Files:** 3 files (trpc router, module, controller)
- **Time:** 45 minutes
- **Status:** NOT STARTED

### Codex Task 7: Create Shared Packages
- **File:** `CODEX_007_20260207.prompts.md` (to be created)
- **What:** Setup `@openchat/types` and `@openchat/config`
- **Files:** 4 files (2 package.json + 2 index.ts)
- **Time:** 30 minutes
- **Status:** NOT STARTED

### Codex Task 8: Setup tRPC Client in Mobile
- **File:** `CODEX_008_20260207.prompts.md` (to be created)
- **What:** Configure tRPC client and call health check
- **Files:** 2 files (trpc client, usage in app)
- **Time:** 30 minutes
- **Status:** NOT STARTED

### Codex Task 9: Verify Docker Compose Stack
- **File:** `CODEX_009_20260208.prompts.md` (to be created)
- **What:** Test Docker services (PostgreSQL, Redis, API)
- **Files:** 0 files (verification only)
- **Time:** 20 minutes
- **Status:** NOT STARTED

### Codex Task 10: Test Expo on iOS Simulator
- **File:** `CODEX_010_20260208.prompts.md` (to be created)
- **What:** Run `npx expo run:ios` and verify
- **Files:** 0 files (testing only)
- **Time:** 15 minutes
- **Status:** NOT STARTED

### Codex Task 11: Test Expo on Android Emulator
- **File:** `CODEX_011_20260209.prompts.md` (to be created)
- **What:** Run `npx expo run:android` and verify
- **Files:** 0 files (testing only)
- **Time:** 15 minutes
- **Status:** NOT STARTED

### Codex Task 12: Configure EAS Build and CI/CD
- **File:** `CODEX_012_20260210.prompts.md` (to be created)
- **What:** Setup EAS profiles, update GitHub Actions
- **Files:** 2 files (eas.json, ci.yml)
- **Time:** 30 minutes
- **Status:** NOT STARTED

---

**Total Codex Tasks:** 12  
**Total Estimated Time:** 6 hours 15 minutes (distributed over 2 weeks)

---

## üîÑ Execution Workflow

### Phase 1: DISCOVER ‚úÖ

**Actions:**
- [x] Read `.copilot/works/codex_next_priorities.md` (12 tasks listed)
- [x] Read `work_reports/01_PROJECT_STATUS.md` (Phase 0.A complete)
- [x] Check git status (clean working tree confirmed)
- [x] Review feature specification (77 features, 20 weeks)
- [x] Identify dependencies (none - first development phase)

**Success Criteria:**
- ‚úÖ All prerequisites met
- ‚úÖ Clear understanding of Phase 0.B scope
- ‚úÖ No blocking issues
- ‚úÖ Ready to begin Codex task execution

---

### Phase 2: DECOMPOSE ‚úÖ

**This master prompt has pre-decomposed tasks:**
- ‚úÖ 12 Codex tasks identified
- ‚úÖ Each task is atomic (15-45 min, 0-3 files)
- ‚úÖ Dependencies mapped (sequential execution)
- ‚úÖ Quality gates defined in each Codex prompt

**Task Dependencies:**
```
Task 1 (Expo)
    ‚Üì
Task 2 (NativeBase) ‚Üê depends on Task 1
    ‚Üì
Task 3 (NativeWind) ‚Üê depends on Task 1, 2
    ‚Üì
Task 4 (NestJS)
    ‚Üì
Task 5 (Prisma) ‚Üê depends on Task 4
    ‚Üì
Task 6 (tRPC server) ‚Üê depends on Task 4, 5
    ‚Üì
Task 7 (Shared packages)
    ‚Üì
Task 8 (tRPC client) ‚Üê depends on Task 1, 6, 7
    ‚Üì
Task 9 (Docker verify) ‚Üê depends on Task 4-8
    ‚Üì
Task 10 (iOS test) ‚Üê depends on Task 1-9
Task 11 (Android test) ‚Üê depends on Task 1-9
    ‚Üì
Task 12 (EAS + CI/CD) ‚Üê depends on all
```

---

### Phase 3: DELEGATE

For each Codex task (execute in order 1-12):

**Step 1:** Verify/Create Codex Prompt
```bash
# Check if Codex prompt exists
ls .copilot/prompts/CODEX_00X_YYYYMMDD.prompts.md

# If not, create using CODEX_README.md template
cat .copilot/prompts/CODEX_README.md
# Follow template to create prompt
```

**Step 2:** Execute via Codex CLI (or manual fallback)
```bash
# Primary: Codex CLI
codex exec --full-auto -C /Volumes/SATECHI_WD_BLACK_2/openchat-expo \
  "$(cat .copilot/prompts/CODEX_00X_YYYYMMDD.prompts.md)"

# If Codex fails: Manual execution
cat .copilot/prompts/CODEX_00X_YYYYMMDD.prompts.md
# Follow implementation steps manually
# Run quality gates manually
# Update documentation manually
```

**Step 3:** Wait for completion, capture output

**Step 4:** Mark Codex task status as COMPLETE in its prompt file

---

### Phase 4: VERIFY

**After Each Codex Task:**
- [ ] Run quality gates from Codex prompt
- [ ] `git diff` shows only intended changes
- [ ] Files modified correctly (not more, not less)
- [ ] No unintended side effects
- [ ] Task-specific verification passed

**After Task Groups:**

**After Tasks 1-3 (Mobile Setup):**
- [ ] Expo app starts: `cd apps/mobile && npx expo start`
- [ ] NativeBase Button renders
- [ ] Tailwind classes work

**After Tasks 4-6 (Backend Setup):**
- [ ] NestJS starts: `cd apps/api && pnpm start`
- [ ] Health endpoint responds: `curl http://localhost:8080/health`
- [ ] tRPC health procedure works
- [ ] Prisma schema has 14 models

**After Tasks 7-8 (Integration):**
- [ ] Mobile calls backend tRPC procedure
- [ ] Shared types work in both apps
- [ ] Type safety verified

**After Tasks 9-11 (Platform Testing):**
- [ ] Docker services healthy
- [ ] iOS simulator runs app
- [ ] Android emulator runs app
- [ ] Web browser runs app

**After Task 12 (Deployment):**
- [ ] EAS Build completes successfully
- [ ] CI/CD pipeline passes all checks
- [ ] No warnings or errors

**Final Phase 0.B Verification:**
- [ ] All 12 Codex tasks marked COMPLETE
- [ ] All quality gates passed
- [ ] No regressions introduced
- [ ] Performance acceptable (<2s app launch)
- [ ] Documentation updated (5 files)

---

### Phase 5: DOCUMENT

**Update 5 Required Files:**

#### 1. `.copilot/works/codex_work_progress_and_reply.md`
```markdown
## Master Prompt 001 Complete - Phase 0.B Done

**Feature:** Phase 0.B - Project Scaffolding
**Date:** 2026-02-10 17:00 JST
**Codex Tasks:** 12/12 complete
**Time:** 6h 30min actual (6h 15min estimated, 104% accuracy)
**Issues:** None - all tasks completed successfully

**What Was Accomplished:**
- Expo mobile app initialized with tabs, NativeBase, NativeWind
- NestJS backend with tRPC and Prisma (14 models)
- Shared packages for types and config
- Docker Compose services operational
- EAS Build and CI/CD configured
- Tested on iOS, Android, Web

**Verification:**
- All 12 Codex tasks complete ‚úÖ
- All quality gates passed ‚úÖ
- Mobile-backend communication working ‚úÖ
- Docker services healthy ‚úÖ
- Multi-platform testing successful ‚úÖ
```

#### 2. `work_reports/01_PROJECT_STATUS.md`
```markdown
## ‚úÖ Latest Progress (February 10, 2026 17:00 JST) - **PHASE 0.B COMPLETE** ÔøΩÔøΩ

- üéØ **Phase 0.B:** Project Scaffolding 100% complete (12/12 tasks)
- üì± **Expo App:** Running on iOS, Android, Web with NativeBase + NativeWind
- üîß **Backend:** NestJS + tRPC + Prisma (14 models)
- üê≥ **Docker:** PostgreSQL + Redis services operational
- üöÄ **Deployment:** EAS Build + CI/CD pipeline passing
- ‚è±Ô∏è **Timeline:** On track (Week 2 of 20 complete)

**Ready for Phase 1:** Authentication & User Management (Week 3-6)
```

#### 3. `work_reports/00_FEATURE_CHECKLIST.md`
```markdown
## üéØ **PHASE 0: PROJECT SETUP - ‚úÖ 100% COMPLETE**

| Task | Status | Notes | Done |
|------|--------|-------|------|
| GitHub repository | ‚úÖ Complete | https://github.com/shaifulshabuj/openchat-expo | [x] |
| Copilot infrastructure | ‚úÖ Complete | 240KB documentation, 10 skills | [x] |
| Expo app initialized | ‚úÖ Complete | Tabs + NativeBase + NativeWind | [x] |
| NestJS backend | ‚úÖ Complete | tRPC + Prisma (14 models) | [x] |
| Monorepo setup | ‚úÖ Complete | pnpm + Turborepo + shared packages | [x] |
| Docker Compose | ‚úÖ Complete | PostgreSQL + Redis | [x] |
| EAS Build | ‚úÖ Complete | iOS + Android profiles | [x] |
| CI/CD | ‚úÖ Complete | GitHub Actions passing | [x] |
```

#### 4. `.copilot/works/codex_metrics.md`
```markdown
## Master Prompt 001 Metrics

**Phase:** 0.B - Project Scaffolding
**Codex Tasks:** 12
**Estimated Time:** 6h 15min (375 min)
**Actual Time:** 6h 30min (390 min)
**Accuracy:** 104% (4% over estimate - acceptable)
**Success Rate:** 100% (12/12 tasks complete)
**Quality Gates:** 100% pass rate
**Issues:** 0
**Rollbacks:** 0

**Task Breakdown:**
- Simple tasks (6): Average 22 min (est 20 min)
- Moderate tasks (6): Average 35 min (est 35 min)

**Lessons Learned:**
- Codex CLI manual fallback used for all tasks (403 error persists)
- Manual execution reliable and predictable
- Quality gates caught 0 issues (prompts were clear)
- Documentation overhead minimal with templates
```

#### 5. `CHANGELOG.md`
```markdown
## [0.1.0] - 2026-02-10

### Added - Phase 0.B Complete
- Initialized Expo mobile app with tabs template in apps/mobile/
- Installed NativeBase UI component library
- Configured NativeWind (Tailwind CSS for React Native)
- Initialized NestJS backend in apps/api/
- Migrated Prisma schema with 14 database models from PWA
- Configured tRPC server with health check procedure
- Created shared packages (@openchat/types, @openchat/config)
- Setup tRPC client in mobile app
- Verified Docker Compose services (PostgreSQL, Redis)
- Tested Expo on iOS simulator and Android emulator
- Configured EAS Build profiles (development, preview, production)
- Updated CI/CD GitHub Actions workflow

### Verified
- All 12 Codex tasks complete
- Mobile app runs on iOS, Android, Web
- Backend API responds to health checks
- tRPC client-server communication working
- Docker services operational
- EAS Build completes successfully
- CI/CD pipeline passing

### Phase
- Phase 0.B: Project Scaffolding (Week 1-2 of 20) - COMPLETE

### Breaking Changes
- None (initial setup)

### Migration Notes
- Fresh Expo project, no migration needed
- Prisma schema copied from PWA (no data migration yet)
```

---

### Phase 6: CHECKPOINT

**Actions:**
- [ ] Review all changes: `git diff`
- [ ] Review commit history: `git log --oneline --since="2 weeks ago"`
- [ ] Verify working tree clean: `git status`
- [ ] All 5 documentation files updated: ‚úÖ
- [ ] Update master prompt status to COMPLETE
- [ ] Move to next master prompt: `002_20260207.md` (Phase 1: Authentication)

**Commit Message:**
```
‚ú® feat(phase-0b): Complete Project Scaffolding

ADDED:
- Expo mobile app (tabs + NativeBase + NativeWind)
- NestJS backend (tRPC + Prisma)
- Shared packages (@openchat/types, @openchat/config)
- Docker Compose (PostgreSQL + Redis)
- EAS Build configuration
- Multi-platform support (iOS, Android, Web)

VERIFIED:
- All 12 Codex tasks complete
- Mobile-backend communication working
- Docker services healthy
- Multi-platform testing successful
- EAS Build passing
- CI/CD pipeline passing

CODEX TASKS: 12/12 complete
TIME: 6h 30min (estimated: 6h 15min, 104% accuracy)
PHASE: 0.B - Project Scaffolding COMPLETE
```

---

## üéØ Success Criteria

Phase 0.B is complete when:
- [x] All 12 Codex tasks executed successfully
- [x] Expo app runs on iOS, Android, Web
- [x] NestJS backend responds to health checks
- [x] tRPC client calls backend procedures
- [x] Prisma schema has 14 models
- [x] Docker Compose services operational
- [x] EAS Build completes without errors
- [x] CI/CD pipeline passes all checks
- [x] All 5 documentation files updated
- [x] Changes committed and pushed
- [x] Master prompt marked COMPLETE
- [x] Ready for Phase 1 (Authentication)

---

## üö® Rollback Plan

If Phase 0.B fails completely:

### Nuclear Option:
```bash
cd /Volumes/SATECHI_WD_BLACK_2/openchat-expo
git checkout HEAD -- apps/
git clean -fd apps/
rm -rf apps/mobile apps/api packages/
pnpm install
```

### Partial Rollback (by Codex task):
Each Codex prompt has its own rollback plan. Use those for targeted recovery.

### Resume After Rollback:
1. Identify which Codex task failed
2. Fix the issue causing failure
3. Update Codex prompt if needed
4. Re-execute from failed task forward
5. Verify all quality gates
6. Continue to completion

---

## üìä Estimated Impact

**Lines of Code:** ~1,000 (generated by templates)  
**Files Created:** ~100  
**Files Modified:** ~10  
**Breaking Changes:** None  
**Migration Progress:** Phase 0 complete (0/77 features, but foundation ready)

---

## üîó Related Master Prompts

**Depends On:**
- None (first master prompt)

**Blocks:**
- Master Prompt 002: Phase 1 - Authentication System
- All subsequent feature prompts

**Related:**
- `.copilot/works/codex_next_priorities.md` - Detailed task queue
- `work_reports/03_MIGRATION_DECISIONS.md` - Why these technologies

---

**Status:** NOT STARTED  
**Created:** 2026-02-04 14:20 JST  
**Start Date:** 2026-02-04 (planned)  
**End Date:** TBD  
**Version:** 1.0
