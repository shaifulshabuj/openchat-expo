# ü§ñ Codex CLI Usage Guide for OpenChat Expo

**Official Docs:** https://developers.openai.com/codex  
**GitHub Repo:** https://github.com/openai/codex  
**Version:** Based on @openai/codex latest  
**Last Updated:** February 4, 2026

---

## üìö What is Codex CLI?

Codex CLI is OpenAI's **local coding agent** that can:
- Write code based on natural language descriptions
- Understand and explain complex codebases
- Review code for bugs and issues
- Debug and fix problems
- Automate repetitive development tasks

**Key Features:**
- ‚úÖ Runs **locally** on your computer
- ‚úÖ Can execute shell commands (with sandboxing)
- ‚úÖ Generates git diffs for changes
- ‚úÖ Works with ChatGPT Plus/Pro/Team/Enterprise plans
- ‚úÖ Non-interactive mode for automation (`codex exec`)

---

## üöÄ Installation

```bash
# Using npm (recommended)
npm install -g @openai/codex

# Using Homebrew (macOS)
brew install --cask codex

# Verify installation
codex --help
```

---

## üîê Authentication

```bash
# Sign in with ChatGPT (recommended)
codex login
# Select "Sign in with ChatGPT"
# Follow the browser authentication flow

# Check login status
codex login --status

# Sign out
codex logout
```

---

## üìñ Command Reference

### 1. Interactive Mode (Primary Use)
Start an interactive coding session:

```bash
# Basic interactive session
codex

# With initial prompt
codex "Add user authentication to the API"

# In specific directory
codex -C /path/to/project "Fix the login bug"

# With web search enabled
codex --search "Research and implement OAuth2"

# With full auto-approval (workspace-write sandbox)
codex --full-auto "Add TypeScript types to all files"
```

### 2. Non-Interactive Execution (`codex exec`)
Run Codex non-interactively for automation:

```bash
# Basic exec command
codex exec "Create a new React component for user profile"

# With JSON output for parsing
codex exec --json "Add unit tests for auth service"

# Save last message to file
codex exec -o output.txt "Generate API documentation"

# Full auto mode (less friction)
codex exec --full-auto "Refactor database queries"

# From stdin
echo "Add error handling" | codex exec -

# Specific working directory
codex exec -C apps/api "Add health check endpoint"
```

### 3. Apply Changes (`codex apply`)
Apply diffs generated by Codex:

```bash
# Apply changes from a specific task ID
codex apply <task-id>

# Workflow:
# 1. Run: codex exec "Make changes"
# 2. Codex generates diff
# 3. Review the diff
# 4. Apply: codex apply <task-id>
```

### 4. Code Review (`codex review`)
Run code reviews:

```bash
# Review current changes
codex review

# Non-interactive review
codex exec review
```

### 5. Resume/Fork Sessions
Continue or branch from previous sessions:

```bash
# Resume last session
codex resume --last

# Fork last session
codex fork --last

# Interactive picker for sessions
codex resume
codex fork
```

---

## üéØ Best Practices for OpenChat Expo

### ‚úÖ DO: Small, Atomic Tasks

**Good Examples:**
```bash
# Single file, single responsibility
codex exec "Add TypeScript interface for ContactRequest in packages/types/src/contacts.ts"

# Clear scope, verifiable
codex exec "Create health check endpoint at apps/api/src/routes/health.ts returning 200 with {status: 'ok'}"

# Specific file modification
codex exec "Update apps/mobile/app.json to set version to 1.0.0"

# Small refactor
codex exec "Extract validation logic from apps/api/src/routes/auth.ts into apps/api/src/utils/validation.ts"
```

**Why Small Tasks Work Better:**
- ‚úÖ Faster execution (1-3 minutes vs 10-30 minutes)
- ‚úÖ Easier to verify (git diff is readable)
- ‚úÖ Less likely to fail or get stuck
- ‚úÖ Clear success criteria
- ‚úÖ Easy to retry if needed
- ‚úÖ Better tracking and metrics

### ‚ùå DON'T: Large, Vague Tasks

**Bad Examples:**
```bash
# Too broad, will take forever
codex exec "Implement the entire authentication system"

# Vague scope
codex exec "Fix all bugs in the API"

# Multiple responsibilities
codex exec "Add user profile feature with UI, API, database, and tests"

# No clear endpoint
codex exec "Improve performance"
```

---

## üîí Sandbox Modes (Security)

Codex has three sandbox levels:

### 1. `read-only` (Safest)
- ‚úÖ Can read files
- ‚ùå Cannot write files
- ‚ùå Cannot execute commands
- **Use for:** Code review, exploration, analysis

```bash
codex -s read-only "Explain the authentication flow"
```

### 2. `workspace-write` (Balanced - **Recommended**)
- ‚úÖ Can read files
- ‚úÖ Can write files in workspace
- ‚úÖ Can execute safe commands
- ‚ö†Ô∏è Requires approval for dangerous commands
- **Use for:** Normal development tasks

```bash
codex -s workspace-write "Add new API endpoint"
# Or shorthand:
codex --full-auto "Add new API endpoint"
```

### 3. `danger-full-access` (Least Safe)
- ‚úÖ Full file system access
- ‚úÖ Can execute any command
- ‚ö†Ô∏è **DANGEROUS** - use only in sandboxed environments
- **Use for:** System-level operations (rarely needed)

```bash
# Only use if absolutely necessary
codex -s danger-full-access "Install system dependencies"
```

**For OpenChat Expo:** Use `workspace-write` (or `--full-auto`) for all normal tasks.

---

## üé¨ Recommended Workflow for OpenChat Expo

### Pattern 1: Single File Creation/Modification

```bash
# 1. Use codex exec for single file tasks
codex exec --full-auto -C /Volumes/SATECHI_WD_BLACK_2/openchat-expo \
  "Create apps/api/src/routes/contacts.ts with POST /contacts/request endpoint. 
   Follow pattern in apps/api/src/routes/auth.ts. 
   Return 201 with {requestId, status}."

# 2. Check the output
git diff apps/api/src/routes/contacts.ts

# 3. Verify it works
curl -X POST http://localhost:8080/api/contacts/request \
  -H "Content-Type: application/json" \
  -d '{"targetUserId": "user123"}'

# 4. Commit if good
git add apps/api/src/routes/contacts.ts
git commit -m "feat: add contact request endpoint"
```

### Pattern 2: Configuration Tasks

```bash
# Small config changes work great
codex exec --full-auto "Update apps/mobile/eas.json to add development profile"

# Verify
cat apps/mobile/eas.json | jq .build.development

# Commit
git add apps/mobile/eas.json && git commit -m "chore: add EAS development profile"
```

### Pattern 3: Type Definitions

```bash
# Perfect for type-only tasks
codex exec "Add ContactRequest and ContactResponse types to packages/types/src/contacts.ts"

# Check
cat packages/types/src/contacts.ts

# Commit
git add packages/types/src/contacts.ts && git commit -m "types: add contact request types"
```

---

## ‚è±Ô∏è Task Time Guidelines

To keep Codex tasks small and verifiable:

| Task Type | Max Time | Max Files | Example |
|-----------|----------|-----------|---------|
| **Type Definition** | 1 min | 1 file | Add interface to types package |
| **Single Endpoint** | 3 min | 1-2 files | Create API route + handler |
| **UI Component** | 5 min | 1-2 files | Create React Native component |
| **Configuration** | 2 min | 1 file | Update config file |
| **Small Refactor** | 5 min | 2-3 files | Extract utility function |
| **Test File** | 5 min | 1 file | Add unit tests for service |

**Rule of Thumb:** If task takes >5 minutes, break it down further.

---

## üìã Task Decomposition Examples

### Example 1: Contact Request Feature

**‚ùå Too Large:**
```bash
codex exec "Implement contact request feature with backend API, mobile UI, and Socket.io notifications"
# Problems: Multiple systems, long execution, hard to verify
```

**‚úÖ Broken Down:**
```bash
# Task 1: Types (1 min)
codex exec "Add ContactRequest interface to packages/types/src/contacts.ts"

# Task 2: Backend endpoint (3 min)
codex exec "Create POST /contacts/request endpoint in apps/api/src/routes/contacts.ts"

# Task 3: UI component (5 min)
codex exec "Add ContactRequestButton to apps/mobile/src/components/Contacts/"

# Task 4: Socket event (3 min)
codex exec "Add 'contact:request' Socket.io event to apps/api/src/services/socket.ts"

# Task 5: Mobile handler (2 min)
codex exec "Wire up contact request button to API in apps/mobile/src/screens/ContactsScreen.tsx"
```

### Example 2: Authentication Setup

**‚ùå Too Large:**
```bash
codex exec "Set up complete authentication with JWT, refresh tokens, password hashing, and session management"
```

**‚úÖ Broken Down:**
```bash
# Task 1: Types
codex exec "Add User, LoginRequest, LoginResponse types to packages/types/"

# Task 2: Password utility
codex exec "Create password hashing utilities in apps/api/src/utils/password.ts using bcrypt"

# Task 3: JWT utility
codex exec "Create JWT generation/verification in apps/api/src/utils/jwt.ts"

# Task 4: Auth service
codex exec "Create auth service in apps/api/src/services/auth.ts with login() and register()"

# Task 5: Auth routes
codex exec "Create POST /auth/login and /auth/register in apps/api/src/routes/auth.ts"

# Task 6: Auth middleware
codex exec "Create JWT authentication middleware in apps/api/src/middleware/auth.ts"
```

---

## üîç Verification Checklist

After each Codex task, verify:

1. **Files Changed:**
   ```bash
   git status
   git diff
   ```

2. **Code Compiles:**
   ```bash
   pnpm build
   # Or specific workspace:
   pnpm --filter openchat-api build
   ```

3. **Types Valid:**
   ```bash
   pnpm type-check
   ```

4. **Task-Specific Check:**
   - API endpoint: `curl` test
   - UI component: View in Expo Go
   - Config: Validate with tool (jq, jsonlint)
   - Types: TypeScript compilation

5. **Commit if Good:**
   ```bash
   git add <files>
   git commit -m "<conventional-commit-message>"
   ```

---

## üö® Troubleshooting Codex

### Issue 1: "403 Forbidden" or API Error

**Symptoms:**
```
Request failed with status 403 Forbidden: Invalid URL
```

**Solutions:**
```bash
# 1. Check login status
codex login --status

# 2. Re-authenticate
codex logout
codex login

# 3. Verify subscription (needs ChatGPT Plus/Pro/Team)
# Visit: https://chatgpt.com/codex

# 4. If still failing, use manual fallback
# Execute task with GitHub Copilot assistance
```

### Issue 2: Codex Gets Stuck

**Symptoms:** Task runs for >10 minutes, no progress

**Solutions:**
```bash
# 1. Cancel with Ctrl+C

# 2. Break task into smaller pieces
# Instead of: "Implement entire auth system"
# Do: "Create auth types", "Create auth service", etc.

# 3. Use more specific instructions
# Add file paths, patterns to follow, expected output
```

### Issue 3: Incorrect Code Generated

**Symptoms:** Code doesn't follow project patterns or has bugs

**Solutions:**
```bash
# 1. Provide more context in prompt
codex exec "Create endpoint in apps/api/src/routes/users.ts 
  following the EXACT pattern in apps/api/src/routes/auth.ts.
  Use same error handling, same response structure."

# 2. Reference specific files
codex exec "Update apps/api/src/services/contacts.ts 
  to match the pattern in apps/api/src/services/auth.ts.
  Use same dependency injection style."

# 3. Be explicit about requirements
codex exec "Add TypeScript interface with EXACT fields: 
  id (string), username (string), email (string), createdAt (Date)"
```

---

## üìä Codex vs Manual Execution

| Aspect | Codex CLI | Manual (GitHub Copilot) |
|--------|-----------|-------------------------|
| **Speed** | Fast for small tasks | Depends on complexity |
| **Automation** | Fully automated | Semi-automated |
| **Control** | Less control | Full control |
| **Verification** | Same (git diff) | Same (git diff) |
| **Dependencies** | Requires API access | Always available |
| **Best For** | Repetitive tasks, configs | Complex logic, debugging |

**Recommendation:** Use Codex for small, well-defined tasks. Use manual execution for:
- Complex multi-step features
- Tasks requiring human judgment
- When Codex API is unavailable
- Debugging and troubleshooting

---

## üéØ Quick Reference: Codex Commands for OpenChat Expo

### Common Tasks

```bash
# Add new API endpoint
codex exec --full-auto -C apps/api "Create POST /api/contacts endpoint in src/routes/contacts.ts"

# Create React Native component
codex exec --full-auto -C apps/mobile "Create ProfileCard component in src/components/Profile/"

# Add TypeScript types
codex exec -C packages/types "Add Message and Conversation interfaces to src/messaging.ts"

# Update configuration
codex exec "Set expo.version to '1.0.0' in apps/mobile/app.json"

# Create test file
codex exec -C apps/api "Add unit tests for src/services/auth.ts in src/tests/auth.test.ts"

# Refactor code
codex exec "Extract validation logic from apps/api/src/routes/users.ts to src/utils/validation.ts"

# Generate documentation
codex exec "Add JSDoc comments to all functions in apps/api/src/services/contacts.ts"
```

### Verification Commands

```bash
# After any task
git status && git diff

# Type check
pnpm type-check

# Build check
pnpm build

# API endpoint check
curl http://localhost:8080/api/<endpoint>

# Mobile app check
cd apps/mobile && npx expo start
```

---

## üìù Integration with OpenChat Expo Workflow

### In PHASE 2: DELEGATE

When delegating to Codex, use this format:

```bash
codex exec --full-auto -C /Volumes/SATECHI_WD_BLACK_2/openchat-expo \
  "<CLEAR_TASK_DESCRIPTION>
   
   Files: <SPECIFIC_FILES>
   Pattern: Follow <REFERENCE_FILE>
   Expected: <SUCCESS_CRITERIA>
   Verify: <VERIFICATION_COMMAND>"
```

**Example:**
```bash
codex exec --full-auto -C /Volumes/SATECHI_WD_BLACK_2/openchat-expo \
  "Create contact request API endpoint.
   
   Files: apps/api/src/routes/contacts.ts
   Pattern: Follow apps/api/src/routes/auth.ts structure
   Expected: POST /contacts/request returns 201 with {requestId, status}
   Verify: curl -X POST http://localhost:8080/api/contacts/request"
```

### In PHASE 4: VERIFY

```bash
# 1. Check files changed
git status

# 2. Review the diff
git diff

# 3. Run quality gates
pnpm type-check
pnpm build

# 4. Task-specific verification
# (curl, expo start, etc.)

# 5. If passed, commit
git add . && git commit -m "feat: <description>"
```

---

## üéì Learning from Experience

### After Each Codex Task:

1. **Time tracking:** Record actual execution time
2. **Success rate:** Did it work first try?
3. **Retries needed:** How many attempts?
4. **Quality:** Was code following patterns?
5. **Lessons:** What made it succeed/fail?

Update `.copilot/works/codex_metrics.md` after each task.

---

## ‚úÖ Summary: Key Takeaways

1. **Keep tasks small** - 1-5 minutes, 1-3 files max
2. **Be specific** - Include file paths, patterns, success criteria
3. **Use workspace-write sandbox** - `--full-auto` flag
4. **Verify immediately** - git diff, build, test
5. **Track metrics** - Learn what works, iterate
6. **Have fallback** - GitHub Copilot manual execution always works
7. **Commit often** - Small atomic commits
8. **Reference patterns** - Point to existing code to follow

---

**Official Resources:**
- Docs: https://developers.openai.com/codex
- GitHub: https://github.com/openai/codex
- Help: https://help.openai.com/en/articles/11369540-codex-in-chatgpt
